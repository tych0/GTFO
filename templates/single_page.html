$def with (meta, content, comments, reply_form)
$:render.header(meta)
<div id="page">
  <div id="content">

    <div class="post">
      <h2 class="title">$(meta.title)</h2>

      <p class="byline">
        <small>Posted by $meta.author
        $if meta.date:
          on $(meta.date)
        </small>
      </p>
      <div class="entry">
        $:content
      </div>
      <div class="meta">
        <p class="links">$len(comments) comments 
          &nbsp;&bull;&nbsp;&nbsp;
          Tags: 
          $:', '.join([ '<a href="/tags/%s">%s</a>' % (tag.strip(), tag.strip()) for tag in meta.tags.split(',') ])
      </div>
    </div>

    $# This is a little goofy... since form.validates() modifies the internal
    $# state of the form (and apparently things are not executed inside templates
    $# in-order), we simply check the note attribute of the form, since if validate
    $# has been called it wil be set with some message, and if not it won't.
    $if reply_form.note:
      <script type="text/javascript">
        document.reply_form.name.focus();
      </script>
 
    <div class="comments">
      $for comment in comments:
        <div class="comment">
          <p>
            $if comment.url:
              <a href="$comment.url">$comment.name</a> 
            $else:
              $comment.name
            @ $comment.time:
          </p>
          <p>$comment.payload</p>
        </div>
    </div>
		<div id="reply_id" class="reply" style="padding: 10px;">
			<form name="reply_form" method="post" action="/$(meta.slug)/comment">
			  $:reply_form.render()
				<input type="submit" value="Post Reply" />
			</form>
		</div>
  </div>
  <!-- end #content -->
  $:render.sidebar()
</div>
<!-- end #page -->
$:render.footer()
